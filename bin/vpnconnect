#! /bin/sh
#
# Dependencies: ifconfig, openconnect, screen, sudo, /etc/vpnc/vpnc-script

VPN_USER=surya1
VPN_HOST=vpn.llnl.gov
TUN_IFAC=llnlvpn.tun0

RUN_USER=${USER}
SOK_NAME=${VPN_USER}.${VPN_HOST}
STY_NAME=${PPID}.${SOK_NAME}

ifconfig ${TUN_IFAC} >/dev/null 2>&1 && exec screen -R ${SOK_NAME}

if [ "${STY}" = "${STY_NAME}" ]; then
	exec sudo openconnect \
		--interface=${TUN_IFAC} \
		--setuid=${RUN_USER} \
		--user=${VPN_USER} \
		--script=/etc/vpnc/vpnc-script \
		--no-dtls \
		${VPN_HOST}
else
	exec screen -S ${SOK_NAME} ${0}
fi
